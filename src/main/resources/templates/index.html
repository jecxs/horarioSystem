<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="~{fragments/layout :: head('Inicio')}"></head>
<body>
<div th:replace="~{fragments/layout :: header}"></div>

<div class="container-fluid">
    <div class="row mt-4">
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card border-primary h-100">
                <div class="card-body text-center">
                    <i class="fas fa-chalkboard-teacher fa-3x text-primary mb-3"></i>
                    <h5 class="card-title">Docentes</h5>
                    <p class="card-text">Total: <span id="totalDocentes" th:text="${totalDocentes}">0</span></p>
                    <a href="/docentes" class="btn btn-primary btn-sm">
                        <i class="fas fa-list me-1"></i>Ver Todos
                    </a>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card border-success h-100">
                <div class="card-body text-center">
                    <i class="fas fa-book fa-3x text-success mb-3"></i>
                    <h5 class="card-title">Cursos</h5>
                    <p class="card-text">Total: <span id="totalCursos" th:text="${totalCursos}">0</span></p>
                    <a href="/cursos" class="btn btn-success btn-sm">
                        <i class="fas fa-list me-1"></i>Ver Todos
                    </a>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card border-info h-100">
                <div class="card-body text-center">
                    <i class="fas fa-building fa-3x text-info mb-3"></i>
                    <h5 class="card-title">Ambientes</h5>
                    <p class="card-text">Total: <span id="totalAmbientes" th:text="${totalAmbientes}">0</span></p>
                    <a href="/ambientes" class="btn btn-info btn-sm">
                        <i class="fas fa-list me-1"></i>Ver Todos
                    </a>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card border-danger h-100">
                <div class="card-body text-center">
                    <i class="fas fa-th fa-3x text-danger mb-3"></i>
                    <h5 class="card-title">Tablero de Horarios</h5>
                    <p class="card-text">Gestión de asignaciones de horarios</p>
                    <a href="/tablero" class="btn btn-danger btn-sm">
                        <i class="fas fa-external-link-alt me-1"></i>Ir al Tablero
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Acciones Rápidas -->
    <div class="row mt-3">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Acciones Rápidas</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <button class="btn btn-outline-primary w-100" data-bs-toggle="modal" data-bs-target="#modalCrearDocente">
                                <i class="fas fa-user-plus me-1"></i>Registrar Nuevo Docente
                            </button>
                        </div>
                        <div class="col-md-4 mb-3">
                            <button class="btn btn-outline-success w-100" data-bs-toggle="modal" data-bs-target="#modalCrearCurso">
                                <i class="fas fa-plus-circle me-1"></i>Registrar Nuevo Curso
                            </button>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="/tablero" class="btn btn-outline-danger w-100">
                                <i class="fas fa-clock me-1"></i>Gestionar Horarios
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comprobación de Configuración Inicial -->
    <div class="row mt-4 mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">Estado de Configuración</h5>
                </div>
                <div class="card-body">
                    <div id="configuracionContainer">
                        <p>Verificando estado de configuración...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Crear Docente -->
<div class="modal fade" id="modalCrearDocente" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Registrar Nuevo Docente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form th:action="@{/docentes}" method="post" th:object="${nuevoDocente}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="nombreCompleto" class="form-label">Nombre completo:</label>
                        <input type="text" class="form-control" id="nombreCompleto" th:field="*{nombreCompleto}" required>
                    </div>
                    <div class="mb-3">
                        <label for="especialidad" class="form-label">Especialidad:</label>
                        <input type="text" class="form-control" id="especialidad" th:field="*{especialidad}">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para Crear Curso (simplificado) -->
<div class="modal fade" id="modalCrearCurso" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Registrar Nuevo Curso</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Se cargará dinámicamente con AJAX -->
                <div id="modalCursoContent">
                    <div class="text-center py-3">
                        <div class="spinner-border text-success" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <p class="mt-2">Cargando formulario...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{fragments/layout :: footer}"></div>

<script>
    $(document).ready(function() {
        // Cargar estado de configuración
        $.ajax({
            url: '/verificar-configuracion',
            type: 'GET',
            success: function(data) {
                let html = '<div class="row">';

                // Modalidades
                html += '<div class="col-md-3 mb-3">';
                html += '<div class="card h-100 ' + (data.modalidadesConfiguradas ? 'border-success' : 'border-danger') + '">';
                html += '<div class="card-body">';
                html += '<h6 class="card-title">Modalidades Educativas</h6>';
                html += '<p class="card-text">';
                if (data.modalidadesConfiguradas) {
                    html += '<span class="text-success"><i class="fas fa-check-circle"></i> Configurado</span>';
                } else {
                    html += '<span class="text-danger"><i class="fas fa-times-circle"></i> Pendiente</span>';
                }
                html += '</p>';
                html += '<a href="/configuracion/modalidades" class="btn btn-sm ' + (data.modalidadesConfiguradas ? 'btn-outline-success' : 'btn-success') + '">';
                html += (data.modalidadesConfiguradas ? '<i class="fas fa-edit"></i> Editar' : '<i class="fas fa-plus-circle"></i> Configurar');
                html += '</a>';
                html += '</div></div></div>';

                // Carreras
                html += '<div class="col-md-3 mb-3">';
                html += '<div class="card h-100 ' + (data.carrerasConfiguradas ? 'border-success' : 'border-danger') + '">';
                html += '<div class="card-body">';
                html += '<h6 class="card-title">Carreras</h6>';
                html += '<p class="card-text">';
                if (data.carrerasConfiguradas) {
                    html += '<span class="text-success"><i class="fas fa-check-circle"></i> Configurado</span>';
                } else {
                    html += '<span class="text-danger"><i class="fas fa-times-circle"></i> Pendiente</span>';
                }
                html += '</p>';
                html += '<a href="/configuracion/carreras" class="btn btn-sm ' + (data.carrerasConfiguradas ? 'btn-outline-success' : 'btn-success') + '">';
                html += (data.carrerasConfiguradas ? '<i class="fas fa-edit"></i> Editar' : '<i class="fas fa-plus-circle"></i> Configurar');
                html += '</a>';
                html += '</div></div></div>';

                // Turnos
                html += '<div class="col-md-3 mb-3">';
                html += '<div class="card h-100 ' + (data.turnosConfigurados ? 'border-success' : 'border-danger') + '">';
                html += '<div class="card-body">';
                html += '<h6 class="card-title">Turnos</h6>';
                html += '<p class="card-text">';
                if (data.turnosConfigurados) {
                    html += '<span class="text-success"><i class="fas fa-check-circle"></i> Configurado</span>';
                } else {
                    html += '<span class="text-danger"><i class="fas fa-times-circle"></i> Pendiente</span>';
                }
                html += '</p>';
                html += '<a href="/configuracion/turnos" class="btn btn-sm ' + (data.turnosConfigurados ? 'btn-outline-success' : 'btn-success') + '">';
                html += (data.turnosConfigurados ? '<i class="fas fa-edit"></i> Editar' : '<i class="fas fa-plus-circle"></i> Configurar');
                html += '</a>';
                html += '</div></div></div>';

                // Ambientes
                html += '<div class="col-md-3 mb-3">';
                html += '<div class="card h-100 ' + (data.ambientesConfigurados ? 'border-success' : 'border-danger') + '">';
                html += '<div class="card-body">';
                html += '<h6 class="card-title">Ambientes</h6>';
                html += '<p class="card-text">';
                if (data.ambientesConfigurados) {
                    html += '<span class="text-success"><i class="fas fa-check-circle"></i> Configurado</span>';
                } else {
                    html += '<span class="text-danger"><i class="fas fa-times-circle"></i> Pendiente</span>';
                }
                html += '</p>';
                html += '<a href="/ambientes" class="btn btn-sm ' + (data.ambientesConfigurados ? 'btn-outline-success' : 'btn-success') + '">';
                html += (data.ambientesConfigurados ? '<i class="fas fa-edit"></i> Editar' : '<i class="fas fa-plus-circle"></i> Configurar');
                html += '</a>';
                html += '</div></div></div>';

                html += '</div>';

                // Mensaje de estado general
                html += '<div class="alert ' + (data.configuracionCompleta ? 'alert-success' : 'alert-warning') + ' mt-3">';
                html += '<i class="fas ' + (data.configuracionCompleta ? 'fa-check-circle' : 'fa-exclamation-triangle') + ' me-2"></i>';
                if (data.configuracionCompleta) {
                    html += 'La configuración está completa. Puede empezar a crear horarios.';
                } else {
                    html += 'La configuración está incompleta. Es recomendable completar todos los pasos antes de crear horarios.';
                }
                html += '</div>';

                $('#configuracionContainer').html(html);
            }
        });

        // Cargar modal de curso con AJAX
        $('#modalCrearCurso').on('shown.bs.modal', function () {
            $('#modalCursoContent').load('/cursos/modal-crear');
        });

        // Cargar estadísticas actualizadas
        function cargarEstadisticas() {
            $.ajax({
                url: '/estadisticas',
                type: 'GET',
                success: function(data) {
                    $('#totalDocentes').text(data.totalDocentes);
                    $('#totalCursos').text(data.totalCursos);
                    $('#totalAmbientes').text(data.totalAmbientes);
                }
            });
        }

        // Actualizar estadísticas cada 30 segundos
        setInterval(cargarEstadisticas, 30000);
    });
</script>
</body>
</html>